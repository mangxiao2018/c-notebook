# C语言#define的用法，C语言宏定义

\#define 叫做宏定义命令，它也是C语言预处理命令的一种。所谓宏定义，就是用一个标识符来表示一个字符串，如果在后面的代码中出现了该标识符，那么就全部替换成指定的字符串。

我们先通过一个例子来看一下 #define 的用法：

```c
#include <stdio.h>
#define N 100
int main(){
    int sum = 20 + N;
    printf("%d\n", sum);
    return 0;
}
```

运行结果：
120

注意第 6 行代码`int sum = 20 + N`，`N`被`100`代替了。

`#define N 100`就是宏定义，`N`为宏名，`100`是宏的内容（宏所表示的字符串）。在预处理阶段，对程序中所有出现的“宏名”，预处理器都会用宏定义中的字符串去代换，这称为“宏替换”或“宏展开”。

宏定义是由源程序中的宏定义命令`#define`完成的，宏替换是由预处理程序完成的。

宏定义的一般形式为：

\#define 宏名 字符串

`#`表示这是一条预处理命令，所有的预处理命令都以 # 开头。`宏名`是标识符的一种，命名规则和变量相同。`字符串`可以是数字、表达式、if 语句、函数等。

> 这里所说的字符串是一般意义上的字符序列，不要和C语言中的字符串等同，它不需要双引号。

程序中反复使用的表达式就可以使用宏定义，例如：

```
#define M (n*n+3*n)
```

它的作用是指定标识符`M`来表示`(y*y+3*y)`这个表达式。在编写代码时，所有出现 (y*y+3*y) 的地方都可以用 M 来表示，而对源程序编译时，将先由预处理程序进行宏代替，即用 (y*y+3*y) 去替换所有的宏名 M，然后再进行编译。

将上面的例子补充完整：

```c
#include <stdio.h>
#define M (n*n+3*n)
int main(){
    int sum, n;
    printf("Input a number: ");
    scanf("%d", &n);
    sum = 3*M+4*M+5*M;
    printf("sum=%d\n", sum);
    return 0;
}
```

运行结果：
Input a number: 10↙
sum=1560

程序的开头首先定义了一个宏 M，它表示 (n*n+3*n) 这个表达式。在 9 行代码中使用了宏 M，预处理程序将它展开为下面的语句：

```
sum=3*(n*n+3*n)+4*(n*n+3*n)+5*(n*n+3*n);
```

需要注意的是，在宏定义中表达式`(n*n+3*n)`两边的括号不能少，否则在宏展开以后可能会产生歧义。下面是一个反面的例子：

```
#difine M n*n+3*n
```

在宏展开后将得到下述语句：

```
s=3*n*n+3*n+4*n*n+3*n+5*n*n+3*n;
```

这相当于：

3n2+3n+4n2+3n+5n2+3n

这显然是不正确的。所以进行宏定义时要注意，应该保证在宏替换之后不发生歧义。

#### 对 #define 用法的几点说明

\1) 宏定义是用宏名来表示一个字符串，在宏展开时又以该字符串取代宏名，这只是一种简单粗暴的替换。字符串中可以含任何字符，它可以是常数、表达式、if 语句、函数等，预处理程序对它不作任何检查，如有错误，只能在编译已被宏展开后的源程序时发现。

\2) 宏定义不是说明或语句，在行末不必加分号，如加上分号则连分号也一起替换。

\3) 宏定义必须写在函数之外，其作用域为宏定义命令起到源程序结束。如要终止其作用域可使用`#undef`命令。例如：

```c
#define PI 3.14159
int main(){
    // Code
    return 0;
}
#undef PI
void func(){
    // Code
}
```

表示 PI 只在 main() 函数中有效，在 func() 中无效。

\4) 代码中的宏名如果被引号包围，那么预处理程序不对其作宏代替，例如：

```c
#include <stdio.h>
#define OK 100
int main(){
    printf("OK\n");
    return 0;
}
```

运行结果：
OK

该例中定义宏名 OK 表示 100，但在 printf 语句中 OK 被引号括起来，因此不作宏替换，而作为字符串处理。

\5) 宏定义允许嵌套，在宏定义的字符串中可以使用已经定义的宏名，在宏展开时由预处理程序层层代换。例如：

```c
#define PI 3.1415926
#define S PI*y*y    /* PI是已定义的宏名*/
```

对语句：

```
printf("%f", S);
```

在宏代换后变为：

```
printf("%f", 3.1415926*y*y);
```


\6) 习惯上宏名用大写字母表示，以便于与变量区别。但也允许用小写字母。

\7) 可用宏定义表示数据类型，使书写方便。例如：

```
#define UINT unsigned int
```

在程序中可用 UINT 作变量说明：

```
UINT a, b;
```

应注意用宏定义表示数据类型和用 [typedef](http://c.biancheng.net/cpp/html/100.html) 定义数据说明符的区别。宏定义只是简单的字符串替换，由预处理器来处理；而 typedef 是在编译阶段由编译器处理的，它并不是简单的字符串替换，而给原有的数据类型起一个新的名字，将它作为一种新的数据类型。

请看下面的例子：

```
#define PIN1 int *
typedef int *PIN2;  //也可以写作typedef int (*PIN2);
```

从形式上看这两者相似， 但在实际使用中却不相同。

下面用 PIN1，PIN2 说明变量时就可以看出它们的区别：

```
PIN1 a, b;
```

在宏代换后变成：

```
int * a, b;
```

表示 a 是指向整型的[指针](http://c.biancheng.net/c/80/)变量，而 b 是整型变量。然而：

```
PIN2 a,b;
```

表示 a、b 都是指向整型的指针变量。因为 PIN2 是一个新的、完整的数据类型。由这个例子可见，宏定义虽然也可表示数据类型， 但毕竟只是简单的字符串替换。在使用时要格外小心，以避出错。